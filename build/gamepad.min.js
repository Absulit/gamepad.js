var et=Object.defineProperty;var st=o=>{throw TypeError(o)};var pt=(o,n,t)=>n in o?et(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t;var x=(o,n)=>et(o,"name",{value:n,configurable:!0});var R=(o,n,t)=>pt(o,typeof n!="symbol"?n+"":n,t),Q=(o,n,t)=>n.has(o)||st("Cannot "+t);var e=(o,n,t)=>(Q(o,n,"read from private field"),t?t.call(o):n.get(o)),i=(o,n,t)=>n.has(o)?st("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(o):n.set(o,t),s=(o,n,t,a)=>(Q(o,n,"write to private field"),a?a.call(o,t):n.set(o,t),t),P=(o,n,t)=>(Q(o,n,"access private method"),t);var dt={buttons:{RJB:0,INDEX:1,HAND:2,A:3,B:4,MENU:5},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3}}},ct={buttons:{LJB:0,INDEX:1,HAND:2,X:3,Y:4,MENU:5},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3}}},it={buttons:{A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,VIEW:8,MENU:9,LJB:10,RJB:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3}}},nt={buttons:{A:0,B:1,X:3,Y:2,LB:4,RB:5,VIEW:8,MENU:9,LJB:10,RJB:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3},LT:4,RT:5}},lt={buttons:{SELECT:0,BACK:1,UP:2,DOWN:3,LEFT:4,RIGHT:5}},ot={buttons:{A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,VIEW:8,MENU:9,LJB:10,RJB:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3}}},at={buttons:{A:0,B:1,X:3,Y:2,LB:4,RB:5,VIEW:8,MENU:9,LJB:10,RJB:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3},LT:4,RT:5}},Et={"Microsoft Controller (STANDARD GAMEPAD Vendor: 045e Product: 02dd)":{mapping:it},"045e-02dd-Microsoft X-Box One pad (Firmware 2015)":{mapping:nt},"Xbox 360 Controller (XInput STANDARD GAMEPAD)":{mapping:it},xinput:{mapping:nt},right:{mapping:dt},left:{mapping:ct},remote:{mapping:lt}};var rt=Math.PI*2,v,B,C,N,X,T,J,y,f,l,O,U,S,w,Z,m=class m extends EventTarget{constructor(t,a){super();i(this,w);i(this,v,!1);i(this,B,!0);i(this,C,null);i(this,N,null);i(this,X,!1);i(this,T,0);i(this,J,0);i(this,y,0);i(this,f,!1);i(this,l,0);i(this,O,0);i(this,U,0);i(this,S,0);s(this,C,t),s(this,N,a)}get name(){return e(this,C)}get index(){return e(this,N)}get x(){return e(this,U)}get y(){return e(this,S)}set debug(t){s(this,X,t)}get angle(){return e(this,T)}get distance(){return e(this,J)}get proportion(){return e(this,y)}get touched(){return e(this,f)}get value(){return e(this,l)}set value(t){s(this,O,e(this,l)),s(this,l,t),s(this,f,-.9<t),e(this,O)===e(this,l)&&e(this,l)===0&&s(this,f,!1),e(this,f)?s(this,l,(e(this,l)+1)*.5):s(this,l,0),P(this,w,Z).call(this)}setProperties({pressed:t,touched:a,value:E,x:c,y:h}){this.pressed=t,s(this,f,a),s(this,U,c),s(this,S,h),s(this,l,E),c&&h&&(s(this,J,Math.sqrt(c*c+h*h)),s(this,T,Math.atan2(-h,c)),s(this,y,e(this,T)/rt),e(this,T)<0&&s(this,T,e(this,T)+rt),s(this,f,Math.abs(c)>.1||Math.abs(h)>.1)),P(this,w,Z).call(this)}onPushed(t){this.addEventListener(m.PUSHED,t)}onReleased(t){this.addEventListener(m.RELEASED,t)}};v=new WeakMap,B=new WeakMap,C=new WeakMap,N=new WeakMap,X=new WeakMap,T=new WeakMap,J=new WeakMap,y=new WeakMap,f=new WeakMap,l=new WeakMap,O=new WeakMap,U=new WeakMap,S=new WeakMap,w=new WeakSet,Z=x(function(){if(e(this,f)&&!e(this,v)&&(this.dispatchEvent(new Event(m.PUSHED)),s(this,v,!0),s(this,B,!1),e(this,X))){let t=e(this,N);if(typeof e(this,N)=="object"){let{x:a,y:E}=e(this,N);t=`{x:${a}, y:${E}}`}console.log(`Button PUSHED: Name: ${e(this,C)}, Index: ${t}`)}!e(this,f)&&!e(this,B)&&(this.dispatchEvent(new Event(m.RELEASED)),s(this,v,!1),s(this,B,!0))},"#dispatchEventIfPushed"),x(m,"Button"),R(m,"PUSHED","PUSHED"),R(m,"RELEASED","RELEASED");var Y=m,b,H,V,G,W,tt=class tt extends EventTarget{constructor(t){super();i(this,b,null);i(this,H,null);i(this,V,null);i(this,G,null);i(this,W,{});s(this,b,t),s(this,H,t.index),s(this,G,t.id)}set gamepad(t){s(this,b,t)}get index(){return e(this,H)}get id(){return e(this,G)}get buttons(){return e(this,W)}get pose(){return e(this,V)}set pose(t){s(this,V,t)}vibrate(t,a){e(this,b).vibrates||(a||(a=1),e(this,b).vibrates=!0,e(this,b).vibrationActuator?.playEffect("dual-rumble",{startDelay:0,duration:t,weakMagnitude:.1,strongMagnitude:a}).then(()=>{e(this,b).vibrates=!1}))}addButton(t,a){e(this,W)[t]=new Y(t,a)}get hasVibrationActuator(){return!!e(this,b).vibrationActuator}};b=new WeakMap,H=new WeakMap,V=new WeakMap,G=new WeakMap,W=new WeakMap,x(tt,"Control");var j=tt,A,L,D,M,$,K,k,I,ht,q,ut,d=class d extends EventTarget{constructor(t){super();i(this,I);i(this,A,null);i(this,L,{});i(this,D,null);i(this,M,!1);i(this,$,!1);i(this,K,x(t=>{let{gamepad:a}=t,{index:E,id:c}=a;e(this,M)&&(console.log("%cGamepadJS.CONNECTED","font-weight: bold; color: #ccc"),console.table({index:E,id:c,mapping:a.mapping}));let h=e(this,L)[`control${E}`]=new j(a);s(this,D,P(this,I,ut).call(this,a)),e(this,A)&&(e(this,D)||s(this,D,e(this,A)[a.id]?.mapping));for(let r in e(this,D).buttons)h.addButton(r,e(this,D).buttons[r]);for(let r in e(this,D).axes)h.addButton(r,e(this,D).axes[r]);this.dispatchEvent(new CustomEvent(d.CONNECTED,{detail:h}))},"#onGamepadConnected"));i(this,k,x(t=>{if(e(this,M)){let{gamepad:a}=t,{index:E,id:c}=a;console.log("%cGamepadJS.DISCONNECTED","font-weight: bold; color: #ccc"),console.table({index:E,id:c,mapping:a.mapping})}e(this,L)[`control${t.gamepad.index}`]=null,this.dispatchEvent(new Event(d.DISCONNECTED))},"#onGamepadDisconnected"));i(this,q,x(t=>typeof t=="object"&&t!==null,"#isObject"));R(this,"update",x(t=>{var E;let a=P(this,I,ht).call(this);for(let c in e(this,L)){let h=e(this,L)[c],r=a[h?.index],F=e(this,D);if(!(!F||!r)){if(h.hasVibrationActuator||(h.gamepad=r),h.pose=r.pose,e(this,$)){for(let u in r.buttons){let p=r.buttons[u];(p.touched||p.pressed)&&console.log(`button: ${u}`)}for(let u in r.axes){let p=r.axes[u];r.TEMP||(r.TEMP={}),(E=r.TEMP)[u]||(E[u]={});let g=r.TEMP[u];g.lastValue=g.value??0,g.value=p,g.touched=Math.abs(g.lastValue-g.value)>.1,g.touched&&console.log(`axis: ${u}`)}}for(let u in F.buttons){let p=h.buttons[u],g=r.buttons[p.index];p.debug=e(this,M),p.setProperties(g)}for(let u in F.axes){let p=F.axes[u],g=e(this,q).call(this,p),z=h.buttons[u];z.debug=e(this,M),g?z.setProperties({x:r.axes[p.x],y:r.axes[p.y]}):z.value=r.axes[p]}}}t(e(this,L))},"update"));if(d.instance)return d.instance;d.instance=this,s(this,A,t),window.addEventListener("gamepadconnected",e(this,K)),window.addEventListener("gamepaddisconnected",e(this,k))}onConnected(t){this.addEventListener(d.CONNECTED,t)}onDisconnected(t){this.addEventListener(d.DISCONNECTED,t)}set debug(t){s(this,M,t)}set logKeys(t){s(this,$,t)}};A=new WeakMap,L=new WeakMap,D=new WeakMap,M=new WeakMap,$=new WeakMap,K=new WeakMap,k=new WeakMap,I=new WeakSet,ht=x(function(){return navigator.getGamepads()},"#getGamepads"),q=new WeakMap,ut=x(function(t){return t.axes.length===6?at:ot},"#getDefaultMapping"),x(d,"GamepadJS"),R(d,"instance"),R(d,"CONNECTED","CONNECTED"),R(d,"DISCONNECTED","DISCONNECTED");var _=d;export{Y as Button,j as Control,_ as GamepadJS,Et as gamepadInfo};
