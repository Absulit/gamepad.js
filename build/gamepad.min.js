var et=Object.defineProperty;var st=o=>{throw TypeError(o)};var ct=(o,i,t)=>i in o?et(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var x=(o,i)=>et(o,"name",{value:i,configurable:!0});var R=(o,i,t)=>ct(o,typeof i!="symbol"?i+"":i,t),Q=(o,i,t)=>i.has(o)||st("Cannot "+t);var e=(o,i,t)=>(Q(o,i,"read from private field"),t?t.call(o):i.get(o)),n=(o,i,t)=>i.has(o)?st("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(o):i.set(o,t),s=(o,i,t,a)=>(Q(o,i,"write to private field"),a?a.call(o,t):i.set(o,t),t),X=(o,i,t)=>(Q(o,i,"access private method"),t);var pt={buttons:{RJB:0,INDEX:1,HAND:2,A:3,B:4,MENU:5},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3}}},dt={buttons:{LJB:0,INDEX:1,HAND:2,X:3,Y:4,MENU:5},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3}}},nt={buttons:{A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,VIEW:8,MENU:9,LJB:10,RJB:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3}}},it={buttons:{A:0,B:1,X:3,Y:2,LB:4,RB:5,VIEW:8,MENU:9,LJB:10,RJB:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3},LT:4,RT:5}},lt={buttons:{SELECT:0,BACK:1,UP:2,DOWN:3,LEFT:4,RIGHT:5}},ot={buttons:{A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,VIEW:8,MENU:9,LJB:10,RJB:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3}}},at={buttons:{A:0,B:1,X:3,Y:2,LB:4,RB:5,VIEW:8,MENU:9,LJB:10,RJB:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},axes:{LJX:{x:0,y:1},RJX:{x:2,y:3},LT:4,RT:5}},Et={"Microsoft Controller (STANDARD GAMEPAD Vendor: 045e Product: 02dd)":{mapping:nt},"045e-02dd-Microsoft X-Box One pad (Firmware 2015)":{mapping:it},"Xbox 360 Controller (XInput STANDARD GAMEPAD)":{mapping:nt},xinput:{mapping:it},right:{mapping:pt},left:{mapping:dt},remote:{mapping:lt}};var rt=Math.PI*2,B,C,A,T,y,L,J,O,f,E,U,S,w,H,Z,m=class m extends EventTarget{constructor(t,a){super();n(this,H);n(this,B,!1);n(this,C,!0);n(this,A,null);n(this,T,null);n(this,y,!1);n(this,L,0);n(this,J,0);n(this,O,0);n(this,f,!1);n(this,E,0);n(this,U,0);n(this,S,0);n(this,w,0);s(this,A,t),s(this,T,a)}get name(){return e(this,A)}get index(){return e(this,T)}get x(){return e(this,S)}get y(){return e(this,w)}set debug(t){s(this,y,t)}get angle(){return e(this,L)}get distance(){return e(this,J)}get proportion(){return e(this,O)}get touched(){return e(this,f)}get value(){return e(this,E)}set value(t){s(this,U,e(this,E)),s(this,E,t),s(this,f,-.9<t),e(this,U)===e(this,E)&&e(this,E)===0&&s(this,f,!1),e(this,f)?s(this,E,(e(this,E)+1)*.5):s(this,E,0),X(this,H,Z).call(this)}setProperties({pressed:t,touched:a,value:c,x:l,y:h}){this.pressed=t,s(this,f,a),s(this,S,l),s(this,w,h),s(this,E,c),l&&h&&(s(this,J,Math.sqrt(l*l+h*h)),s(this,L,Math.atan2(-h,l)),s(this,O,e(this,L)/rt),e(this,L)<0&&s(this,L,e(this,L)+rt),s(this,f,Math.abs(l)>.1||Math.abs(h)>.1)),X(this,H,Z).call(this)}onPushed(t){this.addEventListener(m.PUSHED,t)}onReleased(t){this.addEventListener(m.RELEASED,t)}};B=new WeakMap,C=new WeakMap,A=new WeakMap,T=new WeakMap,y=new WeakMap,L=new WeakMap,J=new WeakMap,O=new WeakMap,f=new WeakMap,E=new WeakMap,U=new WeakMap,S=new WeakMap,w=new WeakMap,H=new WeakSet,Z=x(function(){if(e(this,f)&&!e(this,B)&&(this.dispatchEvent(new Event(m.PUSHED)),s(this,B,!0),s(this,C,!1),e(this,y))){let t=e(this,T);if(typeof e(this,T)=="object"){let{x:a,y:c}=e(this,T);t=`{x:${a}, y:${c}}`}console.log(`Button PUSHED: Name: ${e(this,A)}, Index: ${t}`)}!e(this,f)&&!e(this,C)&&(this.dispatchEvent(new Event(m.RELEASED)),s(this,B,!1),s(this,C,!0))},"#dispatchEventIfPushed"),x(m,"Button"),R(m,"PUSHED","PUSHED"),R(m,"RELEASED","RELEASED");var Y=m,b,V,G,W,v,tt=class tt extends EventTarget{constructor(t){super();n(this,b,null);n(this,V,null);n(this,G,null);n(this,W,null);n(this,v,{});s(this,b,t),s(this,V,t.index),s(this,W,t.id)}set gamepad(t){s(this,b,t)}get index(){return e(this,V)}get id(){return e(this,W)}get buttons(){return e(this,v)}get pose(){return e(this,G)}set pose(t){s(this,G,t)}vibrate(t,a){e(this,b).vibrates||(a||(a=1),e(this,b).vibrates=!0,e(this,b).vibrationActuator?.playEffect("dual-rumble",{startDelay:0,duration:t,weakMagnitude:.1,strongMagnitude:a}).then(()=>{e(this,b).vibrates=!1}))}addButton(t,a){e(this,v)[t]=new Y(t,a)}get hasVibrationActuator(){return!!e(this,b).vibrationActuator}get touched(){for(let t in e(this,v))if(e(this,v)[t].touched)return!0;return!1}};b=new WeakMap,V=new WeakMap,G=new WeakMap,W=new WeakMap,v=new WeakMap,x(tt,"Control");var j=tt,I,N,D,M,$,k,K,P,ht,q,ut,d=class d extends EventTarget{constructor(t){super();n(this,P);n(this,I,null);n(this,N,{});n(this,D,null);n(this,M,!1);n(this,$,!1);n(this,k,x(t=>{let{gamepad:a}=t,{index:c,id:l}=a;e(this,M)&&(console.log("%cGamepadJS.CONNECTED","font-weight: bold; color: #ccc"),console.table({index:c,id:l,mapping:a.mapping}));let h=e(this,N)[`control${c}`]=new j(a);s(this,D,X(this,P,ut).call(this,a)),e(this,I)&&(e(this,D)||s(this,D,e(this,I)[a.id]?.mapping));for(let r in e(this,D).buttons)h.addButton(r,e(this,D).buttons[r]);for(let r in e(this,D).axes)h.addButton(r,e(this,D).axes[r]);this.dispatchEvent(new CustomEvent(d.CONNECTED,{detail:h}))},"#onGamepadConnected"));n(this,K,x(t=>{let{gamepad:a}=t,{index:c,id:l}=a;e(this,M)&&(console.log("%cGamepadJS.DISCONNECTED","font-weight: bold; color: #ccc"),console.table({index:c,id:l,mapping:a.mapping}));let h=e(this,N)[`control${c}`];this.dispatchEvent(new CustomEvent(d.DISCONNECTED,{detail:h})),e(this,N)[`control${c}`]=null},"#onGamepadDisconnected"));n(this,q,x(t=>typeof t=="object"&&t!==null,"#isObject"));R(this,"update",x(t=>{var c;let a=X(this,P,ht).call(this);for(let l in e(this,N)){let h=e(this,N)[l],r=a[h?.index],F=e(this,D);if(!(!F||!r)){if(h.hasVibrationActuator||(h.gamepad=r),h.pose=r.pose,e(this,$)){for(let u in r.buttons){let p=r.buttons[u];(p.touched||p.pressed)&&console.log(`button: ${u}`)}for(let u in r.axes){let p=r.axes[u];r.TEMP||(r.TEMP={}),(c=r.TEMP)[u]||(c[u]={});let g=r.TEMP[u];g.lastValue=g.value??0,g.value=p,g.touched=Math.abs(g.lastValue-g.value)>.1,g.touched&&console.log(`axis: ${u}`)}}for(let u in F.buttons){let p=h.buttons[u],g=r.buttons[p.index];p.debug=e(this,M),p.setProperties(g)}for(let u in F.axes){let p=F.axes[u],g=e(this,q).call(this,p),z=h.buttons[u];z.debug=e(this,M),g?z.setProperties({x:r.axes[p.x],y:r.axes[p.y]}):z.value=r.axes[p]}}}t(e(this,N))},"update"));if(d.instance)return d.instance;d.instance=this,s(this,I,t),window.addEventListener("gamepadconnected",e(this,k)),window.addEventListener("gamepaddisconnected",e(this,K))}onConnected(t){this.addEventListener(d.CONNECTED,t)}onDisconnected(t){this.addEventListener(d.DISCONNECTED,t)}set debug(t){s(this,M,t)}set logKeys(t){s(this,$,t)}};I=new WeakMap,N=new WeakMap,D=new WeakMap,M=new WeakMap,$=new WeakMap,k=new WeakMap,K=new WeakMap,P=new WeakSet,ht=x(function(){return navigator.getGamepads()},"#getGamepads"),q=new WeakMap,ut=x(function(t){return t.axes.length===6?at:ot},"#getDefaultMapping"),x(d,"GamepadJS"),R(d,"instance"),R(d,"CONNECTED","CONNECTED"),R(d,"DISCONNECTED","DISCONNECTED");var _=d;export{Y as Button,j as Control,_ as GamepadJS,Et as gamepadInfo};
